// Code generated by oastools. DO NOT EDIT.

package {{.Header.PackageName}}

import (
	"context"
	"sync"
)

// StubServer is a configurable stub implementation of ServerInterface.
// Use it for testing and mocking API behavior.
type StubServer struct {
	mu sync.RWMutex

{{range .Operations}}
	// {{.MethodName}}Func is called when {{.MethodName}} is invoked.
	// If nil, returns the default response.
	{{.MethodName}}Func func(ctx context.Context, req *{{.RequestType}}) ({{.ResponseType}}, error)
{{end}}
}

// NewStubServer creates a new StubServer with default responses.
func NewStubServer() *StubServer {
	return &StubServer{}
}

{{range .Operations}}
// {{.MethodName}} implements ServerInterface.
func (s *StubServer) {{.MethodName}}(ctx context.Context, req *{{.RequestType}}) ({{.ResponseType}}, error) {
	s.mu.RLock()
	fn := s.{{.MethodName}}Func
	s.mu.RUnlock()

	if fn != nil {
		return fn(ctx, req)
	}

	// Default response
	return {{.ResponseType | zeroValue}}, nil
}

{{end}}
// Reset clears all custom functions, returning to default behavior.
func (s *StubServer) Reset() {
	s.mu.Lock()
	defer s.mu.Unlock()

{{range .Operations}}
	s.{{.MethodName}}Func = nil
{{end}}
}

// StubServerOption configures a StubServer.
type StubServerOption func(*StubServer)

{{range .Operations}}
// With{{.MethodName}} sets the function to call for {{.MethodName}}.
func With{{.MethodName}}(fn func(ctx context.Context, req *{{.RequestType}}) ({{.ResponseType}}, error)) StubServerOption {
	return func(s *StubServer) {
		s.{{.MethodName}}Func = fn
	}
}

{{end}}
// NewStubServerWithOptions creates a StubServer with the given options.
func NewStubServerWithOptions(opts ...StubServerOption) *StubServer {
	s := NewStubServer()
	for _, opt := range opts {
		opt(s)
	}
	return s
}
