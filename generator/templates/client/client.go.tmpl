// Code generated by oastools. DO NOT EDIT.

package {{.Header.PackageName}}

import (
	"bytes"
	"context"
	"encoding/json"
	"fmt"
	"io"
	"net/http"
	"net/url"
	"strings"
)

// Client is the API client.
type Client struct {
	// BaseURL is the base URL for API requests.
	BaseURL string
	// HTTPClient is the HTTP client to use for requests.
	HTTPClient *http.Client
	// UserAgent is the User-Agent header value for requests.
	UserAgent string
	// RequestEditors are functions that can modify requests before sending.
	RequestEditors []RequestEditorFn
}

// RequestEditorFn is a function that can modify an HTTP request.
type RequestEditorFn func(ctx context.Context, req *http.Request) error

// ClientOption is a function that configures a Client.
type ClientOption func(*Client) error

// NewClient creates a new API client.
func NewClient(baseURL string, opts ...ClientOption) (*Client, error) {
	c := &Client{
		BaseURL:    strings.TrimSuffix(baseURL, "/"),
		HTTPClient: &http.Client{Timeout: 30 * time.Second},
		UserAgent:  {{.DefaultUserAgent | quote}},
	}
	for _, opt := range opts {
		if err := opt(c); err != nil {
			return nil, err
		}
	}
	return c, nil
}

// WithHTTPClient sets the HTTP client.
func WithHTTPClient(client *http.Client) ClientOption {
	return func(c *Client) error {
		c.HTTPClient = client
		return nil
	}
}

// WithRequestEditor adds a request editor function.
func WithRequestEditor(fn RequestEditorFn) ClientOption {
	return func(c *Client) error {
		c.RequestEditors = append(c.RequestEditors, fn)
		return nil
	}
}

// WithUserAgent sets the User-Agent header value.
func WithUserAgent(ua string) ClientOption {
	return func(c *Client) error {
		c.UserAgent = ua
		return nil
	}
}

{{range .ParamsStructs}}
// {{.MethodName}}Params contains query parameters for {{.MethodName}}.
type {{.MethodName}}Params struct {
{{range .Fields}}{{if .Comment}}	// {{.Comment}}
{{end}}	{{.Name}} {{.Type}} `json:"{{.Tags}}"`
{{end}}}

{{end}}// APIError represents an API error response.
type APIError struct {
	StatusCode int
	Body       []byte
}

func (e *APIError) Error() string {
	return fmt.Sprintf("API error: status %d: %s", e.StatusCode, string(e.Body))
}
