# Chi Router Support for Server Generation

## Overview

Add support for generating server routers using the [go-chi/chi](https://github.com/go-chi/chi) framework as an alternative to the stdlib `net/http` router.

## Current State

- `--server-router=stdlib` generates a router using `net/http` with custom path matching via `httpvalidator.PathMatcherSet`
- Chi support was planned but not implemented (placeholder removed in v1.32.0)

## Motivation

Chi is a popular, lightweight router that provides:
- Native path parameter extraction (`chi.URLParam`)
- Middleware chaining with `chi.Use()`
- Route grouping with `chi.Group()`
- OpenAPI-compatible path patterns (`/pets/{petId}`)
- Better integration with existing chi-based applications

## Implementation Plan

### Phase 1: Template Creation

Create `generator/templates/server/router_chi.go.tmpl`:

```go
// Code generated by oastools. DO NOT EDIT.

package {{.Header.PackageName}}

import (
    "context"
    "net/http"

    "github.com/go-chi/chi/v5"
)

// NewChiRouter creates a chi.Router that dispatches requests to the server.
func NewChiRouter(server ServerInterface, opts ...RouterOption) chi.Router {
    r := chi.NewRouter()

    // Apply middleware options
    for _, opt := range opts {
        opt(r)
    }

    // Register routes
{{range .Operations}}
    r.{{.Method}}("{{.Path}}", func(w http.ResponseWriter, req *http.Request) {
        handle{{.MethodName}}(server, w, req)
    })
{{end}}

    return r
}

{{range .Operations}}
func handle{{.MethodName}}(server ServerInterface, w http.ResponseWriter, req *http.Request) {
    ctx := req.Context()

    srvReq := &{{.RequestType}}{
        HTTPRequest: req,
    }

{{range .PathParams}}
    srvReq.{{.FieldName}} = chi.URLParam(req, "{{.Name}}")
{{end}}

    resp, err := server.{{.MethodName}}(ctx, srvReq)
    if err != nil {
        WriteError(w, http.StatusInternalServerError, err.Error())
        return
    }

    if respWriter, ok := any(resp).(interface{ WriteTo(http.ResponseWriter) error }); ok {
        _ = respWriter.WriteTo(w)
        return
    }

    WriteJSON(w, http.StatusOK, resp)
}
{{end}}
```

### Phase 2: Generator Updates

1. **Template selection** in `oas3_generator.go`:
   ```go
   func (cg *oas3CodeGenerator) generateServerRouter() error {
       templateName := "router.go.tmpl"
       if cg.gen.ServerRouter == "chi" {
           templateName = "router_chi.go.tmpl"
       }
       // ...
   }
   ```

2. **Import handling**: Chi router needs `github.com/go-chi/chi/v5` import

3. **RouterOption type**: May differ between stdlib and chi implementations

### Phase 3: Documentation

- Update CLI reference with chi examples
- Update generator deep dive with chi usage patterns
- Add example showing chi middleware integration

### Phase 4: Testing

- Unit tests for chi template generation
- Compile test to verify generated chi code compiles
- Integration test with actual chi router

## Considerations

### Dependency Management

Generated chi code will import `github.com/go-chi/chi/v5`. Users must:
```bash
go get github.com/go-chi/chi/v5
```

This is acceptable since chi is opt-in and users choosing chi already depend on it.

### API Compatibility

Both stdlib and chi routers should:
- Accept the same `ServerInterface`
- Support similar middleware patterns
- Provide `PathParam()` helper (chi uses `chi.URLParam()`)

### Path Pattern Compatibility

Chi uses the same `{param}` syntax as OpenAPI, so path patterns translate directly:
- OpenAPI: `/pets/{petId}`
- Chi: `/pets/{petId}` (native support)

## Timeline

- **Priority**: Low (stdlib router is fully functional)
- **Effort**: ~2-4 hours
- **Dependencies**: None

## Related

- PR #171: Server generation extensions (stdlib router)
- `httpvalidator.PathMatcherSet`: Custom path matching for stdlib
